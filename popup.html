<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chesstention - Chess Extension</title>
  <meta name="description" content="Play chess locally, vs computer, or online with friends. Clean UI, multiple themes, and professional chess experience.">
  
  <!-- Preconnect to external domains for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Font loading with display=swap for better performance -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Stylesheet -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Background video with accessibility considerations -->
  <video id="bgVideo" class="bg-video" autoplay muted loop playsinline aria-hidden="true">
    <source src="media/menu-background.mp4" type="video/mp4">
    <!-- Fallback for browsers that don't support video -->
    Your browser does not support the video tag.
  </video>
  <div class="bg-dim" aria-hidden="true"></div>

  <main id="app" role="main">
    <!-- ============== MENU SCREEN ============== -->
    <section id="menuScreen" class="screen menu-screen is-active" aria-label="Main menu">
      <header class="menu">
        <div class="menu-header">
          <img src="images/chesstention-logo.png" 
               alt="Chesstention Logo" 
               class="menu-logo-img"
               width="350" 
               height="auto"
               loading="eager">
        </div>

        <nav class="menu-buttons" role="navigation" aria-label="Game mode selection">
          <!-- Online Play Section -->
          <div id="playOnlineContainer" class="online-btn-container">
            <button id="playOnlineBtn" 
                    type="button" 
                    class="menu-btn menu-btn--primary"
                    aria-describedby="online-description">
              Play Online
            </button>
            <button id="cancelSearchBtn" 
                    type="button" 
                    class="cancel-search-btn" 
                    style="display: none;"
                    aria-label="Cancel search">
              Ã—
            </button>
            <div id="online-description" class="sr-only">
              Play chess online with other players
            </div>
          </div>
          
          <!-- Computer Play Section -->
          <button id="toggleAiBtn" 
                  type="button" 
                  class="menu-btn"
                  aria-expanded="false"
                  aria-controls="cpuOptions"
                  aria-describedby="computer-description">
            Play vs Computer
          </button>
          <div id="computer-description" class="sr-only">
            Play against the computer with adjustable difficulty
          </div>

          <!-- CPU Color Selection -->
          <div id="cpuOptions" 
               class="cpu-options" 
               role="group" 
               aria-label="Choose computer color"
               aria-hidden="true">
            <button id="aiWhiteBtn" 
                    type="button" 
                    class="btn-toggle"
                    aria-pressed="false">
              CPU: White
            </button>
            <button id="aiBlackBtn" 
                    type="button" 
                    class="btn-toggle"
                    aria-pressed="false">
              CPU: Black
            </button>
          </div>

          <!-- Local Play -->
          <button id="newGameBtn" 
                  type="button" 
                  class="menu-btn"
                  aria-describedby="local-description">
            1v1 (Hot-Seat)
          </button>
          <div id="local-description" class="sr-only">
            Play locally with two players on the same device
          </div>

          <!-- LAN Play -->
          <button id="openJoinPanel" 
                  type="button" 
                  class="menu-btn"
                  aria-expanded="false"
                  aria-controls="joinPanel"
                  aria-describedby="lan-description">
            Join/Create Room
          </button>
          <div id="lan-description" class="sr-only">
            Play over local network with friends
          </div>
        </nav>

        <!-- LAN Connection Panels -->
        <section id="joinPanel" 
                 class="lan-panel" 
                 role="region" 
                 aria-label="Join room"
                 aria-hidden="true">
          <div class="row">
            <label class="lbl" for="joinHost">Signaling host</label>
            <input id="joinHost" 
                   class="input" 
                   type="text" 
                   placeholder="e.g. 192.168.1.35"
                   aria-describedby="joinHost-help">
            <button id="joinConnectBtn" type="button">Connect</button>
          </div>
          <div class="row">
            <label class="lbl" for="joinRoomCode">Room code</label>
            <input id="joinRoomCode" 
                   class="input" 
                   type="text" 
                   placeholder="Enter code from host"
                   aria-describedby="joinRoomCode-help">
            <button id="joinDoBtn" type="button" class="btn-primary">Join Room</button>
          </div>
          <div id="joinHost-help" class="sr-only">Enter the IP address of the signaling server</div>
          <div id="joinRoomCode-help" class="sr-only">Enter the room code provided by the host</div>
        </section>

        <section id="createPanel" 
                 class="lan-panel" 
                 role="region" 
                 aria-label="Create room"
                 aria-hidden="true">
          <div class="row">
            <label class="lbl" for="createHost">Signaling host</label>
            <input id="createHost" 
                   class="input" 
                   type="text" 
                   placeholder="e.g. 192.168.1.35"
                   aria-describedby="createHost-help">
            <button id="createConnectBtn" type="button">Connect</button>
          </div>
          <div class="row">
            <button id="createDoBtn" type="button" class="btn-primary">Create Room</button>
            <input id="createRoomCode" 
                   class="input" 
                   type="text" 
                   placeholder="Room code will appear here" 
                   readonly
                   aria-label="Generated room code">
            <button id="copyCreateCode" type="button">Copy</button>
          </div>
          <div id="createHost-help" class="sr-only">Enter the IP address of the signaling server</div>
        </section>
      </header>
    </section>

    <!-- ============== GAME SCREEN ============== -->
    <section id="gameScreen" 
             class="screen game-screen is-hidden" 
             aria-label="Chess game"
             aria-hidden="true">
      
      <!-- Modern Game Status Bar -->
      <header class="game-header" role="banner">
        <div class="header-container">
          <!-- Left Navigation -->
          <button id="backToMenuBtn" 
                  class="nav-btn nav-btn--left" 
                  aria-label="Back to Menu" 
                  title="Back to Menu">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="4" y1="12" x2="20" y2="12"></line>
              <polyline points="10 6 4 12 10 18"></polyline>
            </svg>
          </button>

          <!-- Center Game Info -->
          <div class="game-info">
            <!-- Turn Indicator with Dot -->
            <div class="turn-display">
              <div class="turn-dot"></div>
              <span id="turnIndicator" class="turn-text">White's Turn</span>
            </div>
            
            <!-- Move Counter (removed - not needed) -->
            
            <!-- Theme Switcher -->
            <div class="theme-switcher">
              <button class="theme-option theme-classic active" data-theme="classic" title="Classic Theme">
                <div class="theme-square"></div>
              </button>
              <button class="theme-option theme-green" data-theme="green" title="Forest Theme">
                <div class="theme-square"></div>
              </button>
              <button class="theme-option theme-blue" data-theme="blue" title="Ocean Theme">
                <div class="theme-square"></div>
              </button>
            </div>
          </div>

          <!-- Right Controls -->
          <div class="game-controls">
            <button id="undoBtn" 
                    class="nav-btn nav-btn--control" 
                    aria-label="Undo Move"
                    title="Undo">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 14L4 9l5-5"></path>
                <path d="M20 20v-7a4 4 0 00-4-4H4"></path>
              </svg>
            </button>
            <button id="redoBtn" 
                    class="nav-btn nav-btn--control" 
                    aria-label="Redo Move"
                    title="Redo">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 14l5-5-5-5"></path>
                <path d="M4 20v-7a4 4 0 014-4h12"></path>
              </svg>
            </button>
            <button id="disconnectBtn" 
                    class="nav-btn nav-btn--disconnect" 
                    aria-label="Disconnect" 
                    title="Leave Game" 
                    style="display: none;">
              âœ•
            </button>
          </div>
        </div>

        <!-- Game Status Banner -->
        <div id="banner" 
             class="banner" 
             aria-live="polite" 
             aria-atomic="true"
             role="status"></div>
        
        <!-- Game Status Element -->
        <div id="gameStatus" 
             class="game-status" 
             role="status" 
             aria-live="polite"></div>
      </header>

      <!-- Captured Pieces - Black (Top) -->
      <section class="captured-tray top-tray" 
               role="region" 
               aria-label="Captured pieces by black">
        <div class="captured-header">
          <span class="captured-title">CAPTURED BY BLACK</span>
         
        </div>
        <div id="capturedByBlack" 
             class="captured-pieces" 
             role="list" 
             aria-label="Pieces captured by black player"></div>
      </section>

      <!-- Chess Board -->
      <section class="board-wrap" role="region" aria-label="Chess board">
        <div id="board" 
             class="board" 
             role="grid" 
             aria-label="Chess board"
             aria-rowcount="8"
             aria-colcount="8"
             tabindex="0"></div>
      </section>

      <!-- Captured Pieces - White (Bottom) -->
      <section class="captured-tray bottom-tray" 
               role="region" 
               aria-label="Captured pieces by white">
        <div class="captured-header">
          <span class="captured-title">CAPTURED BY WHITE</span>
         
        </div>
        <div id="capturedByWhite" 
             class="captured-pieces" 
             role="list" 
             aria-label="Pieces captured by white player"></div>
      </section>

      <!-- Game End Overlay -->
      <dialog id="overlay" 
              class="overlay" 
              aria-labelledby="overlayTitle"
              aria-describedby="overlaySub"
              aria-modal="true">
        <div class="overlay-card">
          <button id="closeOverlayBtn" 
                  class="close-overlay-btn" 
                  type="button" 
                  aria-label="Close overlay">
            Ã—
          </button>
          <h2 id="overlayTitle" class="overlay-title">CHECKMATE</h2>
          <p id="overlaySub" class="overlay-sub"></p>

          <div class="overlay-actions" id="overlayActions" role="group" aria-label="Game end actions">
            <button id="playAgainBtn" 
                    type="button" 
                    class="btn-primary">
              Play Again
            </button>
            <button id="exitToMenuBtn" 
                    type="button" 
                    class="btn-secondary">
              Exit to Menu
            </button>
          </div>
        </div>
      </dialog>

      <!-- Promotion Overlay -->
      <dialog id="promotionOverlay" 
              class="overlay" 
              aria-labelledby="promotionTitle"
              aria-describedby="promotionSub"
              aria-modal="true">
        <div class="overlay-card">
          <h2 id="promotionTitle" class="overlay-title">Promotion</h2>
          <p id="promotionSub" class="overlay-sub">Choose piece to promote to:</p>
          <div class="promotion-options" 
               role="group" 
               aria-label="Promotion piece selection">
            <button class="btn-primary" 
                    data-promote="Q" 
                    aria-label="Promote to Queen">
              Queen
            </button>
            <button data-promote="R" 
                    aria-label="Promote to Rook">
              Rook
            </button>
            <button data-promote="B" 
                    aria-label="Promote to Bishop">
              Bishop
            </button>
            <button data-promote="N" 
                    aria-label="Promote to Knight">
              Knight
            </button>
          </div>
        </div>
      </dialog>

    </section>
  </main>

  <!-- Application Script -->
  <script src="script.js"></script>
</body>
</html>